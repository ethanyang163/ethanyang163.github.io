<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.13.5"/><style data-href="/styles.d6e3fe2d414a2aca125b.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#073642}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{background:#eee8d5;color:#657b83}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.layout-module--container--78b04{font-family:sans-serif;margin:auto;max-width:500px}.layout-module--heading--f158c{color:#639}.layout-module--nav-links--1113b{display:flex;list-style:none;padding-left:0}.layout-module--nav-link-item--a5f0a{padding-right:2rem}.layout-module--nav-link-text--69cda{color:#000}.layout-module--site-title--e4dea{color:gray;font-size:3rem;font-weight:700;margin:3rem 0}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-gatsby-head="true">浏览器的Event Loop | Ethan Yang</title></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout-module--container--78b04"><header class="layout-module--site-title--e4dea">Ethan Yang</header><nav><ul class="layout-module--nav-links--1113b"><li class="layout-module--nav-link-item--a5f0a"><a class="layout-module--nav-link-text--69cda" href="/">Home</a></li><li class="layout-module--nav-link-item--a5f0a"><a class="layout-module--nav-link-text--69cda" href="/about/">About</a></li><li class="layout-module--nav-link-item--a5f0a"><a class="layout-module--nav-link-text--69cda" href="/blog/">Blog</a></li></ul></nav><main><h1 class="layout-module--heading--f158c">浏览器的Event Loop</h1><p>我们时常会看到的关于 JavaScript 的一些名词：</p>
<p><strong>单线程</strong>：one thread == one call stack == one thing at a time</p>
<p><strong>阻塞</strong>：当耗时的任务（图片处理、同步的网络请求等）出现在调用栈中时即为阻塞</p>
<p><strong>异步</strong>：异步调用也许是解决阻塞最简单的方法</p>
<p><strong>并发</strong>：Event Loop 所要解决的问题。JavaScript Runtime 每次只能做一件事情，但是浏览器里不仅仅只有 JavaScript Runtime。👇</p>
<img src="https://ethanyounglife.oss-cn-beijing.aliyuncs.com/%E6%88%AA%E5%B1%8F2021-02-20%2014.32.41.png?x-oss-process=image/resize,m_lfit,w_600" alt=""/>
<p>通过<a href="http://latentflip.com/loupe/?code=Cgpjb25zb2xlLmxvZygnSGknKTsKCnNldFRpbWVvdXQoZnVuY3Rpb24gY2IoKSB7CiAgICBjb25zb2xlLmxvZygndGhlcmUnKTsKfSwgMzAwMCkKCmNvbnNvbGUubG9nKCdKU0NvbmYnKQ%3D%3D!!!" rel="nofollow noopener noreferrer">Loupe</a>(一种展示 JavaScript 的 Call Stack、Event Loop、Callback Queue 如何协作的可视化工具)来看一下事件循环是如何工作的</p>
<img src="https://pic2.zhimg.com/50/v2-093b11b0b5337fc5165bcbdb3811cfd6_720w.webp?source=c8b7c179" alt=""/>
<p>Event Loop 不止一个任务队列，当微任务队列和 UI 渲染再加入到这个流程中时：</p>
<img src="https://ethanyounglife.oss-cn-beijing.aliyuncs.com/event-loop.jpg" alt=""/>
<p>再次看一段代码的执行，这次同时包含了宏任务与微任务：</p>
<img src="https://pic3.zhimg.com/50/v2-778d214a75a2a7a0abd63b891d357b4f_720w.webp?source=c8b7c179" alt=""/>
<h3>总结</h3>
<p>事件循环算法：</p>
<ol>
<li>从宏任务队列出取出最老的任务执行</li>
<li>执行所有的微任务，直至微任务队列为空为止</li>
<li>必要时渲染 UI</li>
<li>如果宏任务队列为空，等待一个新的任务出现</li>
<li>执行步骤 1</li>
</ol>
<h3>[参考资料]</h3>
<p><a href="http://lynnelv.github.io/js-event-loop-browser" rel="nofollow noopener noreferrer">深入理解 js 事件循环机制（浏览器篇）</a></p>
<p><a href="https://www.youtube.com/watch?v=8aGhZQkoFbQ&amp;feature=youtu.be" rel="nofollow noopener noreferrer">What the heck is the event loop anyway? | Philip Roberts | JSConf EU</a></p>
<p><a href="https://www.youtube.com/watch?v=cCOL7MC4Pl0" rel="nofollow noopener noreferrer">Jake Archibald: In The Loop - JSConf.Asia</a></p></main></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/post-2021-02-22/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-0d25acd4b5b80c0ec1c0.js\"],\"component---src-pages-404-js\":[\"/component---src-pages-404-js-8418e948c6af4847a834.js\"],\"component---src-pages-about-js\":[\"/component---src-pages-about-js-1fcb0d27a1924476424a.js\"],\"component---src-pages-blog-index-js\":[\"/component---src-pages-blog-index-js-5e0caaf646d460e0db1d.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-post-2021-02-22-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-post-2021-02-22-mdx-315a82b8acfe1bd6b698.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-post-2021-06-02-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-post-2021-06-02-mdx-04522693818a5613a7e5.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-post-2022-12-10-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-post-2022-12-10-mdx-9cfa1c827bbf9c82ade2.js\"],\"component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-post-2023-06-01-mdx\":[\"/component---src-pages-blog-mdx-frontmatter-slug-js-content-file-path-blog-post-2023-06-01-mdx-3702e40122ae1cc3bf2d.js\"],\"component---src-pages-index-js\":[\"/component---src-pages-index-js-70951c0a33aeccdbf5e8.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="4c139764a06242b8e968";</script><script src="/webpack-runtime-f7191a3c96d1c673a4c9.js" async></script><script src="/framework-00bf2bb98c1b8e9fbdeb.js" async></script><script src="/app-0d25acd4b5b80c0ec1c0.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>